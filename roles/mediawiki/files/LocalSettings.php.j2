<?php
/**
 * Copyright (C) 2013 Orain, Kudu and contributors
 *
 * This file is part of Orain's playbook.
 *
 * Orain's playbook is free software: you can redistribute it and/or modify it
 * under the terms of the GNU Affero General Public License as published by the
 * Free Software Foundation, either version 3 of the License, or (at your option)
 * any later version.
 *
 * Orain's playbook is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more
 * details.
 *
 * You should have received a copy of the GNU Affero General Public License along
 * with Orain's playbook.  If not, see <http://www.gnu.org/licenses/>.
 */

// Protect against web entry
if ( !defined( 'MEDIAWIKI' ) ) {
	exit;
}

/**
 * Load the below extensions for all wikis
 *
 * @note If you are including a new extension you should ensure it is included in
 *  the mediawiki-core repo in the extensions directory
 * @note To make sure it updates according to that repo it should also be included
 *  in the main.yml task file for mediawiki
 */
require_once( "$IP/extensions/AdminLinks/AdminLinks.php" );
require_once( "$IP/extensions/AntiSpoof/AntiSpoof.php" );
require_once( "$IP/extensions/AbuseFilter/AbuseFilter.php" );
require_once( "$IP/extensions/Babel/Babel.php" );
require_once( "$IP/extensions/CategoryTree/CategoryTree.php" );
require_once( "$IP/extensions/CentralAuth/CentralAuth.php" );
require_once( "$IP/extensions/CentralNotice/CentralNotice.php" );
require_once( "$IP/extensions/CheckUser/CheckUser.php" );
require_once( "$IP/extensions/Cite/Cite.php" );
require_once( "$IP/extensions/Cite/SpecialCite.php" );
require_once( "$IP/extensions/ConfirmEdit/Asirra.php" );
require_once( "$IP/extensions/ConfirmEdit/ConfirmEdit.php" );
require_once( "$IP/extensions/DismissableSiteNotice/DismissableSiteNotice.php" );
require_once( "$IP/extensions/intersection/DynamicPageList.php" );
require_once( "$IP/extensions/Gadgets/Gadgets.php" );
require_once( "$IP/extensions/GlobalBlocking/GlobalBlocking.php" );
require_once( "$IP/extensions/InputBox/InputBox.php" );
require_once( "$IP/extensions/Interwiki/Interwiki.php" );
require_once( "$IP/extensions/MassMessage/MassMessage.php" );
require_once( "$IP/extensions/Nuke/Nuke.php" );
require_once( "$IP/extensions/OrainMessages/OrainMessages.php" );
require_once( "$IP/extensions/ParserFunctions/ParserFunctions.php" );
require_once( "$IP/extensions/Renameuser/Renameuser.php" );
require_once( "$IP/extensions/Scribunto/Scribunto.php" );
require_once( "$IP/extensions/SimpleAntiSpam/SimpleAntiSpam.php" );
require_once( "$IP/extensions/SiteMatrix/SiteMatrix.php" );
require_once( "$IP/extensions/SpamBlacklist/SpamBlacklist.php" );
require_once( "$IP/extensions/SyntaxHighlight_GeSHi/SyntaxHighlight_GeSHi.php" );
require_once( "$IP/extensions/TemplateSandbox/TemplateSandbox.php" );
require_once( "$IP/extensions/TitleBlacklist/TitleBlacklist.php" );
require_once( "$IP/extensions/TitleKey/TitleKey.php" );
require_once( "$IP/extensions/Variables/Variables.php" );
require_once( "$IP/extensions/YouTube/YouTube.php" );
require_once( "$IP/skins/foreground/foreground.php" );
require_once( "$IP/skins/monaco/monaco.php" );
require_once( "$IP/extensions/WikiLove/WikiLove.php" );
require_once( "$IP/extensions/NativeSvgHandler/NativeSvgHandler.php" );

$wgConf = new SiteConfiguration;
$wgConf->suffixes = array( 'wiki' );
$wgConf->localVHosts = array( '{{mysql_address}}' );

/**
 * Define namespaces for all wikis
 *
 * @note These namespaces technically are defined across all wikis, they are simply not enabled everywhere.
 * @note These namespaces should NEVER be removed unless all wikis that have ever used them have been deleted
 */

// extension/DPLforum
// @note These are defined automatically by the DPLforum entry file
// define( 'NS_FORUM', 110 );
// define( 'NS_FORUM_TALK', 111 );
// / extension/DPLforum

// allthetropeswiki
define( 'NS_TROPEWORKSHOP', 520 );
define( 'NS_TROPEWORKSHOP_TALK', 521 );
// / allthetropeswiki

// botwiki
define( 'NS_FRAMEWORK', 500 );
define( 'NS_FRAMEWORK_TALK', 501 );
define( 'NS_SCRIPT', 502 );
define( 'NS_SCRIPT_TALK', 503 );
define( 'NS_BOT', 504 );
define( 'NS_BOT_TALK', 505 );
define( 'NS_RUN', 506 );
define( 'NS_RUN_TALK', 507 );
// /botwiki

// councilwiki
define( 'NS_RESOLUTION', 522 );
define( 'NS_RESOLUTION_TALK', 523 );
define( 'NS_WORKSPACE', 524 );
define( 'NS_WORKSPACE_TALK', 525 );
// /councilwiki

// levelswiki
define( 'NS_GUIDE', 258 );
define( 'NS_GUIDE_TALK', 259 );
define( 'NS_MOD', 260 );
define( 'NS_MOD_TALK', 261 );
// /levelswiki

// metawiki
define( 'NS_TECH', 526);
define( 'NS_TECH_TALK', 527);
// /metawiki

// wikinambaswiki
define( 'NS_OFICINA', 508 );
define( 'NS_OFICINA_TALK', 509 );
define( 'NS_PROJETO', 510 );
define( 'NS_PROJETO_TALK', 511 );
define( 'NS_ATIVIDADE', 512 );
define( 'NS_ATIVIDADE_TALK', 513 );
define( 'NS_ESTUDIO', 514 );
define( 'NS_ESTUDIO_TALK', 515 );
// /wikinambaswiki

// frmodamobwiki
define( 'NS_PORTAIL', 516 );
define( 'NS_PORTAIL_TALK', 517 );
define( 'NS_PROJET', 518 );
define( 'NS_PROJET_TALK', 519 );
// /frmodamobwiki

/**
 * NOTE: When changing the below variable all caches need to be updated otherwise
 * we will continue linking to old file locations on cached pages!
 */
$wmgUploadHostname = "d326vv62q24mzw.cloudfront.net";

/**
 * Define settings per wiki
 * @see https://www.mediawiki.org/wiki/Manual:$wgConf
 */
$wgConf->settings = array(
	// AbuseFilter
	'wgAbuseFilterCentralDB' => array(
		'default' => 'metawiki',
	),
	'wgAbuseFilterIsCentral' => array(
		'default' => false,
		'metawiki' => true,
	),
	// /AbuseFilter

	// Anti-spam
	'wgAccountCreationThrottle' => array(
		'default' => 6,
	),
	'wgCaptchaClass' => array(
		'default' => 'Asirra',
	),
	'wgSpamBlacklistFiles' => array(
		'default' => array(
			"DB: metawiki Spam_blacklist",
		),
	),
	'wgTitleBlacklistSources' => array(
		'default' => array(
			array(
				'type' => TBLSRC_LOCALPAGE,
				'src' => 'MediaWiki:Titleblacklist',
			),
			array(
				'type' => TBLSRC_URL,
				'src' => '//meta.orain.org/w/index.php?title=Title_blacklist&action=raw',
			),
		),
	),
	// /Anti-spam

	// Block
	'wgBlockAllowsUTEdit' => array(
		'default' => true,
	),
	// /Block

	// Bigdelete
	'wgDeleteRevisionsLimit' => array(
		'default' => 1000, // Default bigdelete limit
	),
	// /Bigdelete

	// Global block
	'wgApplyGlobalBlocks' => array(
		'default' => true,
		'metawiki' => false,
	),
	// /Global block

	// Cache
	'wgEnableSidebarCache' => array(
		'default' => true,
		'spiralwiki' => false, // This broke displaying of Collection portlets addshore 20-feb-2014 issue #173
	),
	'wgHitcounterUpdateFreq' => array(
		'default' => 20,
	),
	'wgMainCacheType' => array(
		'default' => CACHE_MEMCACHED,
	),
	'wgMemCachedServers' => array(
		'default' => array( '127.0.0.1:11211' ),
	),
	'wgMiserMode' => array(
		'allthetropeswiki' => true,
	),
	'wgParserCacheExpireTime' => array(
		'default' => 604800, // 7 days
	),
	'wgRevisionCacheExpiry' => array(
		'default' => 259200, // 3 days
	),
	'wgSessionsInObjectCache' => array(
		'default' => true,
	),
	'wgUseFileCache' => array(
		'default' => true,
	),
	'wgUseLocalMessageCache' => array(
		'default' => false,
	),
	// /Cache

	// CentralAuth
	'wgCentralAuthAutoLoginWikis' => array(
		'default' => array(
		    'rationalwiki.ssu.lt' => 'rationalwiki',
			'espiral.org' => 'spiralwiki',
			'wikiconstitucio.org' => 'wikiconstituciowiki',
		),
	),
	'wgCentralAuthAutoMigrate' => array(
		'default' => true,
	),
	'wgCentralAuthAutoNew' => array(
		'default' => true,
	),
	'wgCentralAuthCookieDomain' => array(
		'default' => '.orain.org',
	),
	'wgCentralAuthCookies' => array(
		'default' => true,
	),
	'wgCentralAuthCreateOnView' => array(
		'default' => true,
	),
	'wgCentralAuthLoginIcon' => array(
	    'default' => '/usr/share/nginx/favicons/default.ico',
	    'spiralwiki' => '/usr/share/nginx/favicons/espiral.org.ico',
	),
	'wgCentralAuthLoginWiki' => array(
		'default' => 'loginwiki',
	),
	'wgCentralAuthSilentLogin' => array(
		'default' => false, // default value, set to false temporarily -John
	),
	'wgDisableUnmergedEditing' => array(
		'default' => false,
	),
	'wgSiteMatrixSites' => array(
		'default' => array(),
	),
	// /CentralAuth

	// CentralNotice
	'wgNoticeInfrastructure' => array(
		'default' => false,
		'metawiki' => true,
	),
	'wgNoticeProjects' => array(
		'default' => array(),
		// NOTE: 'orain' group means official wikis
		'metawiki' => array( 'orain', 'closed', 'private', 'public' ),
	),
	'wgCentralHost' => array(
		'default' => '//meta.orain.org',
	),
	'wgCentralPagePath' => array(
		'default' => '//meta.orain.org/w/index.php',
	),
	'wgNoticeProject' => array(
		'default' => 'public',
		'metawiki' => 'orain',
		'extloadwiki' => 'orain',
		'loginwiki' => 'orain',
		// private and closed groups are set further down
	),
	// /CentralNotice

	// CheckUser
	'wgCheckUserForceSummary' => array(
		'default' => true,
	),
	// /CheckUser

	// Database
	'wgCompressRevisions' => array(
		'default' => true,
	),
	'wgDBpassword' => array(
		'default' => "{{mw_db_password}}",
	),
	'wgDBprefix' => array(
		'default' => '',
	),
	'wgDBserver' => array(
		'default' => "{{mysql_address}}",
	),
	'wgDBTableOptions' => array(
		'default' => "ENGINE=InnoDB, DEFAULT CHARSET=binary",
	),
	'wgDBtype' => array(
		'default' => 'mysql',
	),
	'wgDBuser' => array(
		'default' => "{{mw_db_user}}",
	),
	'wgSharedDB' => array(
		'default' => 'metawiki',
	),
	'wgSharedTables' => array(
		'default' => array(),
	),
	// /Database

	//Debug
	'wgDebugComments' => array(
		'default' => false,
		'extloadwiki' => true,
	),
	// /Debug

	// Email
	'wgEmailAuthentication' => array(
		'default' => true,
	),
	'wgEmergencyContact' => array(
		'default' => 'help@orain.org',
	),
	'wgEnableEmail' => array(
		'default' => true,
	),
	'wgEnableUserEmail' => array(
		'default' => true,
	),
	'wgEnotifMinorEdits' => array(
		'default' => true,
	),
	'wgEnotifUserTalk' => array(
		'default' => true,
	),
	'wgEnotifWatchlist' => array(
		'default' => true,
	),
	'wgPasswordSender' => array(
		'default' => 'help@orain.org',
	),
	'wgSMTP' => array(
		'default' => array(
			'host' => 'mail.orain.org',
			'port' => 25,
			'IDHost' => 'orain.org',
			'auth' => true,
			'username' => 'help',
			'password' => '{{email_password}}',
		),
	),
	// /Email

	// Files
	'wgEnableUploads' => array(
		'default' => false,
		'upload' => true,
	),
	'wgFileExtensions' => array(
		'default' => array( 'gif', 'ico', 'jpeg', 'jpg', 'ogg', 'png', 'svg' ),
		'+councilwiki' => array( 'pdf' ),
		'+encyclopedianationalwiki' => array( 'pdf' ),
		'+spiralwiki'=> array( 'pdf' ),
	),
	'wgAllowTitlesInSVG' => array(
		'default' => true,
	),
	'wgGenerateThumbnailOnParse' => array(
		'default' => false,
	),
	'wgUseInstantCommons' => array(
		'default' => true,
	),
	// /Files

	// Global Group Settings
	'+wgAvailableRights' => array( // + to avoid any possible conflicts
		'default' => array(
			'debug', // Debugging for sysadmins
			'steward', // Allow this restriction level be added to the global usergroup
		),
	),
	// /Global Group Settings

	// GraphicsMagick
	'wgImageMagickConvertCommand' => array(
		'default' => "/usr/bin/convert",
	),
	'wgShellLocale' => array(
		'default' => "en_US.utf8",
	),
	'wgUseImageMagick' => array(
		'default' => true,
	),
	// /GraphicsMagick

	// Group overrides
	'defaultGroupOverrides' => array(
		'default' => array(
		),
	),
	'specificGroupOverrides' => array(
		'default' => array(),
		'closed' => array(
			'*' => array(
				'edit' => false,
				'createaccount' => false,
			),
			'autoconfirmed' => array(
				'editsemiprotected' => false,
				'patrol' => false,
			),
			'autopatrolled' => array(
				'patrol' => false,
			),
			'bot' => array(
				'editsemiprotected' => false,
			),
			'rollbacker' => array(
				'rollback' => false,
			),
			'sysop' => array(
				'abusefilter-modify' => false,
				'abusefilter-modify-restricted' => false,
				'abusefilter-revert' => false,
				'block' => false,
				'blockemail' => false,
				'createaccount' => false,
				'delete' => false,
				'editinterface' => false,
				'editprotected' => false,
				'editsemiprotected' => false,
				'globalblock-whitelist' => false,
				'import' => false,
				'importupload' => false,
				'move' => false,
				'movefile' => false,
				'move-rootuserpages' => false,
				'move-subpages' => false,
				'nuke' => false,
				'patrol' => false,
				'protect' => false,
				'reupload' => false,
				'reupload-shared' => false,
				'rollback' => false,
				'unblockself' => false,
				'undelete' => false,
				'upload' => false,
			),
			'user' => array(
				'edit' => false,
				'move' => false,
				'move-rootuserpages' => false,
				'move-subpages' => false,
				'movefile' => false,
				'reupload' => false,
				'reupload-shared' => false,
				'upload' => false,
			),
		),
	),
	// /Group overrides

	//Hooks
	'wgSpecialVersionShowHooks' => array(
		'default' => false,
		'extloadwiki' => true,
	),
	// /Hooks

	// Imports
	'wgImportSources' => array(
		'default' => array(
			'meta',
			'test'
		),
		'+testwiki' => array(
			'train'
		),
	),
	// /Imports

	// Keys
	'wgSecretKey' => array(
		'default' => '{{wgSecretKey}}',
	),
	'wgUpgradeKey' => array(
		'default' => '{{wgUpgradeKey}}',
	),
	// /Keys

	// Language
	'wgLanguageCode' => array(
		'default' => 'en',
		'archivoespiral' => 'es',
		'dangsunsnwiki' => 'ko',
		'frmodamobwiki' => 'fr',
		'nsswiki' => 'ko',
		'reviwiki' => 'ko',
		'keionrailwiki' => 'ko',
		'ukrwiki1wiki' => 'uk',
		'verkeerwiki' => 'nl',
		'wikiconstituciowiki' => 'ca',
		'yuewikivoyagewiki' => 'zh-yue',
		'wikinambaswiki' => 'pt-br',
		'worldpediawiki' => 'zh-hant',
	),
	// /Language

	// License
	'wgRightsIcon' => array(
		'default' => "//$wmgUploadHostname/common/skins/common/images/cc-by-sa.png",
		'spiralwiki' => "//$wmgUploadHostname/common/skins/common/images/cc-0.png",
	),
	'wgRightsPage' => array(
		'default' => '',
	),
	'wgRightsText' => array(
		'default' => 'Creative Commons Attribution Share Alike',
		'spiralwiki' => 'CC0 Public Domain',
	),
	'wgRightsUrl' => array(
		'default' => 'https://creativecommons.org/licenses/by-sa/3.0/',
		'spiralwiki' => 'https://creativecommons.org/publicdomain/zero/1.0/',
	),
	// /License

	// MassMessage
	'wgNamespacesToPostIn' => array(
		'default' => array( NS_PROJECT, NS_USER_TALK ),
		'+metawiki' => array( NS_MAIN ),
	),
	'wgNamespacesToConvert' => array(
		'default' => array( NS_USER => NS_USER_TALK ),
	),
	'wgMassMessageAccountUsername' => array(
		'default' => 'OrainMessenger',
	),
	'wgAllowGlobalMessaging' => array(
		'default' => false,
		'metawiki' => true,
	),
	// /MassMessage

	// Misc. extensions
	'ceAllowConfirmedEmail' => array(
		'default' => true,
	),
	'wmgArchivedWiki' => array(
		'default' => false,
		'polymetawiki' => true,
	),
	'wmgClosedWiki' => array(
		'default' => false,
		'closed' => true,
	),
	'+wgCreateWikiSQLfiles' => array(
		'metawiki' => array(
			"$IP/extensions/AbuseFilter/abusefilter.tables.sql",
			"$IP/extensions/AntiSpoof/sql/patch-antispoof.mysql.sql",
			"$IP/extensions/CentralNotice/CentralNotice.sql",
			"$IP/extensions/CheckUser/cu_changes.sql",
			"$IP/extensions/CheckUser/cu_log.sql",
			"$IP/extensions/CreateWiki/global_block_whitelist.sql",
			"$IP/extensions/TitleKey/titlekey.sql",
		),
	),
	'wgInterwikiViewOnly' => array(
		'default' => true,
		'metawiki' => false,
	),
	'wgMFAutodetectMobileView' => array(
		'default' => true,
	),
	'wmgPrivateWiki' => array(
		'default' => false,
		'private' => true,
	),
	'wgThanksConfirmationRequired' => array(
		'default' => true,
		'spiralwiki' => false, // required for testing --addshore qgil
		'testwiki' => false,
	),
	'wgScribuntoUseGeSHi' => array(
		'default' => true,
	),
	'wgScribuntoDefaultEngine' => array(
		'default' => 'luastandalone',
	),
	'wmgUseAPISandbox' => array(
		'default' => false,
		'extloadwiki' => true, // all extensions are loaded on this wiki
		'mediawikitesterswiki' => true,
		'metawiki' => true,
		'wikinambaswiki' => true,
	),
	'wmgUseCharInsert' => array(
		'default' => false,
		'allthetropeswiki' => true,
		'extloadwiki' => true, // all extensions are loaded on this wiki
		'keionrailwiki' => true,
		'mediawikitesterswiki' => true,
	),
	'wmgUseCodeEditor' => array(
		'default' => false,
		'extloadwiki' => true, // all extensions are loaded on this wiki
		'allthetropeswiki' => true,
		'mediawikitesterswiki' => true,
		'wikinambaswiki' => true,
	),
	'wmgUseCollectionPDF' => array(
		'default' => false,
		'spiralwiki' => true,
		'extloadwiki' => true, // All extensions enabled by default
		'wikiconstituciowiki' => true,
	),
	'wmgUseDPLforum' => array(
		'default' => false,
		'extloadwiki' => true, // all extensions are loaded on this wiki
		'allthetropeswiki' => true,
		'frmodamobwiki' => true,
		'mediawikitesterswiki' => true,
		'metawiki' => true,
		'opensourcelearningwiki' => true,
	),
	'wmgUseEchoPack' => array(
		'default' => false,
		'allthetropeswiki' => true,
		'computechwiki' => true,
		'extloadwiki' => true, // all extensions are loaded on this wiki
		'mediawikitesterswiki' => true,
		'metawiki' => true, // Might be nice -- John
		'spiralwiki' => true,
	),
	'wmgUseLiquidThreads' => array(
		'default' => false,
		'allthetropeswiki' => true,
		'extloadwiki' => true, // all extensions are loaded on this wiki
		'mediawikitesterswiki' => true,
		'wikinambaswiki' => true,
	),
	'wmgUseOrainFooter' => array(
		'default' => true,
		'encyclopedianationalwiki' => false,
	),
	'wmgUseMath' => array(
		'default' => false,
		'extloadwiki' => true, // all extensions are loaded on this wiki
		'jdwiki' => true,
		'pmr2014wiki' => true,
	),
	'wmgUseMobileFrontend' => array(
		'default' => false,
		'extloadwiki' => true, // all extensions are loaded on this wiki
		'keionrailwiki' => true,
		'grayhawkwiki' => true,
		'spiralwiki' => true,
		'wikiconstituciowiki' => true,
		'wikinambaswiki' => true,
	),
	'wmgUseQuiz' => array(
		'default' => false,
		'extloadwiki' => true, // all extensions are loaded on this wiki
		'mediawikitesterswiki' => true,
		'patereswiki' => true,
	),
	'wmgUseReplaceText' => array(
		'default' => false,
		'extloadwiki' => true, // all extensions are loaded on this wiki
		'mediawikitesterswiki' => true,
		'patereswiki' => true,
	),
	'wmgUseSideBarMenu' => array(
		'default' => false,
		'extloadwiki' => true, // all extensions are loaded on this wiki
		'allthetropeswiki' => true,
	),
	'wmgUseTabber' => array(
		'default' => false,
		'allthetropeswiki' => true,
		'botwiki' => true,
		'extloadwiki' => true, // all extensions are loaded on this wiki
		'mediawikitesterswiki' => true,
		'patereswiki' => true,
	),
	'wmgUseWikiEditor' => array(
		'default' => true,
		'extloadwiki' => true, // all extensions are loaded on this wiki
		'elderlordswiki' => false,
		'encyclopedianationalwiki' => false,
		'wikinambaswiki' => true,
	),
	// /Misc. extensions

	// Names
	'wgContentNamespaces' => array(
		'botwiki' => array( NS_BOT, NS_FRAMEWORK, NS_SCRIPT ),
		'levelswiki' => array( NS_GUIDE, NS_MOD ),
		'metawiki' => array( NS_TECH ),
	),
	'wgExtraNamespaces' => array(
		'allthetropeswiki' => array(
			NS_TROPEWORKSHOP => 'Trope_Workshop',
			NS_TROPEWORKSHOP_TALK => 'Trope_Workshop_talk',
		),
		'botwiki' => array(
			NS_BOT => 'Bot',
			NS_BOT_TALK => 'Bot_talk',
			NS_FRAMEWORK => 'Framework',
			NS_FRAMEWORK_TALK => 'Framework_talk',
			NS_RUN => 'Run',
			NS_RUN_TALK => 'Run_talk',
			NS_SCRIPT => 'Script',
			NS_SCRIPT_TALK => 'Script_talk',
		),
		'councilwiki' => array(
			NS_RESOLUTION => 'Resolution',
			NS_RESOLUTION_TALK => 'Resolution_talk',
			NS_WORKSPACE => 'Workspace',
			NS_WORKSPACE_TALK => 'Workspace_talk',
		),
		'frmodamobwiki' => array(
			NS_PORTAIL => 'Portail',
			NS_PORTAIL_TALK => 'Discussion_Portail',
			NS_PROJET => 'Projet',
			NS_PROJET_TALK => 'Discussion_Projet',
		),
		'levelswiki' => array(
			NS_GUIDE => 'Guide',
			NS_GUIDE_TALK => 'Guide_talk',
			NS_MOD => 'Mod',
			NS_MOD_TALK => 'Mod_talk',
		),
		'metawiki' => array(
			NS_TECH => 'Tech',
			NS_TECH_TALK => 'Tech_talk',
		),
		'techwiki' => array(
		    NS_TECH => 'Tech',
		),
		'wikinambaswiki' => array(
			NS_OFICINA => 'Oficina',
			NS_OFICINA_TALK => 'Oficina_Discussão',
			NS_PROJETO => 'Projeto',
			NS_PROJETO_TALK => 'Projeto_Discussão',
			NS_ATIVIDADE => 'Atividade',
			NS_ATIVIDADE_TALK => 'Atividade_Discussão',
			NS_ESTUDIO => 'Estúdio',
			NS_ESTUDIO_TALK => 'Estúdio_Discussão',
		),
	),
	'wgMetaNamespace' => array(
		'metawiki' => 'Meta',
	),
	'wgNamespaceAliases' => array(
		'allthetropeswiki' => array(
			'YKTTW' => 520,
			'ATT' => NS_PROJECT,
		),
		'keionrailwiki' => array(
			'사' => NS_USER,
			'사토' => NS_USER_TALK,
		),
		'reviwiki' => array(
			'사' => NS_USER,
			'사토' => NS_USER_TALK,
		),
	),
	'+wgNamespacesWithSubpages' => array(
		'default' => array(
			NS_TEMPLATE => true,
		),
		'+allthetropeswiki' => array(
			NS_MAIN => true,
		),
		'+botwiki' => array(
			NS_BOT => true,
			NS_BOT_TALK => true,
			NS_CATEGORY => true,
			NS_FRAMEWORK => true,
			NS_FRAMEWORK_TALK => true,
			NS_RUN => true,
			NS_RUN_TALK => true,
			NS_SCRIPT => true,
			NS_SCRIPT_TALK => true,
		),
		'+councilwiki' => array(
			NS_RESOLUTION => true,
			NS_WORKSPACE => true,
		),
		'+frmodamobwiki' => array(
			NS_PORTAIL => true,
			NS_PORTAIL_TALK => true,
			NS_PROJET => true,
			NS_PROJET_TALK => true,
		),
		'+mediawikitesterswiki' => array(
			NS_MAIN => true,
		),
		'+metawiki' => array(
			NS_MAIN => true,
			NS_TECH => true,
		),
		'+reviwiki' => array(
			NS_MAIN => true,
		),
		'+wikinambaswiki' => array(
			NS_OFICINA => true,
			NS_OFICINA_TALK => true,
			NS_PROJETO => true,
			NS_PROJETO_TALK => true,
			NS_ATIVIDADE => true,
			NS_ATIVIDADE_TALK => true,
			NS_ESTUDIO => true,
			NS_ESTUDIO_TALK => true,
		),
	),
	'wgSitename' => array(
		'default' => 'Unconfigured',
	),
	// /Names

	// ParserFunctions
	'wgPFEnableStringFunctions' => array(
		'default' => true,
	),
	// /ParserFunctions

	// Permissions
	'wgAddGroups' => array(
		'default' => array(
			'bureaucrat' => array(
				'autopatrolled',
				'bot',
				'bureaucrat',
				'confirmed',
				'member',
				'rollbacker',
				'sysop',
			),
			'sysop' => array(
				'autopatrolled',
				'confirmed',
				'member',
				'rollbacker',
			),
		),
	),
	'wgAutoConfirmAge' => array(
		'default' => 111600, // 31 h * 60 min/h * 60 s/min
		'reviwiki' => 259200,
	),
	'wgAutoConfirmCount' => array(
		'default' => 5,
		'reviwiki' => 20,
	),
	'+wgGroupPermissions' => array(
		'default' => array(
			'*' => array(
				'abusefilter-log' => true,
				'abusefilter-log-detail' => true,
				'abusefilter-view' => true,
			),
			'autoconfirmed' => array(
				'patrol' => true,
				'upload' => true,
			),
			'autopatrolled' => array(
				'autopatrol' => true,
				'patrol' => true,
			),
			'bot' => array(
				'noanalytics' => true,
			),
			'checkuser' => array(
				// Leaks IP addresses
				'abusefilter-private' => true,
			),
			'emailconfirmed' => array(
				'skipcaptcha' => true,
			),
			'importer' => array(
				'import' => true,
				'importupload' => true,
			),
			'oversight' => array(
				'abusefilter-hidden-log' => true,
				'abusefilter-hide-log' => true,
				'browsearchive' => true,
				'deletedhistory' => true,
				'deletedtext' => true,
				'deletelogentry' => true,
				'deleterevision' => true,
				'hideuser' => true,
				'suppressionlog' => true,
				'suppressrevision' => true,
			),
			'rollbacker' => array(
				'autoconfirmed' => true,
				'rollback' => true,
			),
			'sysop' => array(
				'abusefilter-modify' => true,
				'abusefilter-modify-restricted' => true,
				'abusefilter-revert' => true,
				'bigdelete' => false, // Prevent disruption by accidentally deleting large pages
				'deletelogentry' => true,
				'deleterevision' => true,
				'massmessage' => false,
				'rollback' => true,
			),
			'user' => array(
				'user' => true, // Enable a new restriction level globally
			),
		),
		'+encyclopedianationalwiki' => array(
			'*' => array(
				'edit' => false,
			),
		),
		'+metawiki' => array(
			'steward' => array(
				'abusefilter-modify-global' => true,
				'centralauth-lock' => true,
				'centralauth-oversight' => true,
				'centralauth-unmerge' => true,
				'createwiki' => true,
				'globalblock' => true,
				'globalunblock' => true,
				'interwiki' => true,
				'massmessage' => true,
				'noratelimit' => true,
				'userrights' => true,
				'userrights-interwiki' => true,
			),
		),
		'+reviwiki' => array(
			// Continued below, awaiting the creation of a proper override system
			'autoconfirmed' => array(
				'createpage' => true,
			),
		),
	),
	'wgGroupsRemoveFromSelf' => array(
		'default' => array(
			'*' => true,
		)
	),
	'wgRemoveGroups' => array(
		'default' => array(
			'bureaucrat' => array(
				'autopatrolled',
				'bot',
				'confirmed',
				'member',
				'rollbacker',
				'sysop',
			),
			'sysop' => array(
				'autopatrolled',
				'confirmed',
				'member',
				'rollbacker',
			),
		),
	),
	'wmgDisableAnonEditing' => array(
		'default' => false,
		'allthetropeswiki' => true,
		'encyclopedianationalwiki' => true,
		'loginwiki' => true,
		'opensourcelearningwiki' => true,
		'patereswiki' => true,
		'peachywiki' => true,
	),
	// /Permissions

	// Piwik
	'wmgPiwikSiteID' => array(
		'default' => false,
		'allthetropeswiki' => 3,
		'keionrailwiki' => 4,
		'metawiki' => 1,
		'testwiki' => 2,
	),
	// /Piwik

	// Profiling
	'wgEnableProfileInfo' => array(
		'default' => false,
		'allthetropeswiki' => true,
		'metawiki' => true,
	),
	'wgProfileToDatabase' => array(
		'default' => false,
		'allthetropeswiki' => true,
		'metawiki' => true,
	),
	// /Profiling
	
	// RC
	'wmgUseIRCRC' => array(
		'default' => true,
		'private' => false,
	),

	// Redirects
	'wgFixDoubleRedirects' => array(
		'default' => false,
		'allthetropeswiki' => true,
	),
	// /Redirects

	// Restrictions
	'+wgRestrictionLevels' => array(
		'default' => array(
			'user',
			'steward'
		),
	),
	'+wgRestrictionTypes' => array(
		'default' => array(
			'delete'
		),
	),
	// /Restrictions

	// Search
	'wmgUseCirrus' => array(
		'default' => false,
		'allthetropeswiki' => true,
		'mediawikitesterswiki' => true,
	),
	'wmgUseCirrusAsAlternate' => array(
		'default' => false,
		'extloadwiki' => true,
	),
	// /Search

	// Server
	'wgArticlePath' => array(
		'default' => '/wiki/$1',
	),
	'wgDisableOutputCompression' => array(
		'default' => true,
	),
	'wgJobRunRate' => array(
		'default' => 0,
	),
	'wgResourceLoaderMaxQueryLength' => array(
		'default' => -1,
	),
	'wgScriptExtension' => array(
		'default' => '.php',
	),
	'wgScriptPath' => array(
		'default' => '/w',
	),
	'wgServer' => array(
		'default' => '//\$lang.orain.org',
		'rationalwiki' => 'http://rationalwiki.ssu.lt',
		'spiralwiki' => '//espiral.org',
		'wikiconstituciowiki' => 'http://wikiconstitucio.org',
	),
	'wgUsePathInfo' => array(
		'default' => true,
	),
	// /Server

	// Style
	'wgDefaultSkin' => array(
		'default' => 'vector',
		'elderlordswiki' => 'monobook',
	),
	'wgLogo' => array(
		'default' => "//$wmgUploadHostname/meta.orain.org/images/c/c6/Orain.png",
		'allthetropeswiki' => "//$wmgUploadHostname/meta.orain.org/images/a/a6/ATTLogo.png",
		'botwiki' => "//$wmgUploadHostname/meta.orain.org/images/6/65/BotWiki_logo.png",
		'dangsunsnwiki' => '//upload.wikimedia.org/wikipedia/commons/e/e8/Kd-logo.png',
		'computerclanwiki' => '//upload.wikimedia.org/wikipedia/commons/f/f7/CC_Wiki_Graphic_Mark_Small.png',
		'encyclopedianationalwiki' => "//$wmgUploadHostname/encyclopedianational.orain.org/images/2/24/Logo_of_the_Encyclopedia_National.png",
		'enmodamobwiki' => "//$wmgUploadHostname/meta.orain.org/images/d/d6/Modamob-logo.png",
		'frmodamobwiki' => "//$wmgUploadHostname/meta.orain.org/images/d/d6/Modamob-logo.png",
		'grayhawkwiki' => '//upload.wikimedia.org/wikipedia/commons/4/49/GrayhawkPaladinsLogo_%28small%29.png',
		'keionrailwiki' => '//upload.wikimedia.org/wikipedia/commons/e/e4/Subway_TokyoTozai.png',
		'levelswiki' => '//upload.wikimedia.org/wikipedia/commons/thumb/d/d1/Wikilevels_logo_text.png/135px-Wikilevels_logo_text.png',
		'mediawikitesterswiki' => '//upload.wikimedia.org/wikipedia/commons/9/9a/MediaWikiTestersWiki.png',
		'peachywiki' => '//upload.wikimedia.org/wikipedia/commons/5/51/PeachyFrameworkLogo.png',
		'spiralwiki' => '//upload.wikimedia.org/wikipedia/commons/thumb/b/bf/Spiral_project_logo.svg/135px-Spiral_project_logo.svg.png',
		'testwiki' => "//$wmgUploadHostname/test.orain.org/images/8/8d/Twlogo.png",
		'reviwiki' => '//upload.wikimedia.org/wikipedia/commons/thumb/8/87/Train.svg/135px-Train.svg.png',
		'wikiconstituciowiki' => '//upload.wikimedia.org/wikipedia/commons/thumb/c/ce/Flag_of_Catalonia.svg/135px-Flag_of_Catalonia.svg.png',
		'wikinambaswiki' => '//upload.wikimedia.org/wikipedia/commons/thumb/5/53/Wikinambá.png/135px-Wikinambá.png',
	),
	'wgStylePath' => array(
		'default' => "//$wmgUploadHostname/common/skins",
	),
	'wgUseAjax' => array(
		'default' => true,
	),
	// /Style
	// Disable $wgTorLoadNodes

	'wgTorLoadNodes' => array(
		'default' => false,
	),
	
	// Time
	'wgLocaltimezone' => array(
		'default' => 'Europe/London',
		'nsswiki' => 'Asia/Seoul',
		'reviwiki' => 'Asia/Seoul',
	),
	// /Time

	// Translate
	'wgEnablePageTranslation' => array(
		'default' => true,
	),
	'wgTranslateDocumentationLanguageCode' => array(
		'default' => false,
	),
	'wgTranslateFuzzyBotName' => array(
		'default' => 'FuzzyBot',
	),
	'wmgUseTranslate' => array(
		'default' => false,
		'extloadwiki' => true, // all extensions are loaded on this wiki
		'mediawikitesterswiki' => true,
		'metawiki' => true,
		'spiralwiki' => true,
	),
	// /Translate

	// Users
	'wgAllowUserJs' => array(
		'default' => true,
	),
	'wgAllowUserCss' => array(
		'default' => true,
	),
	// /Users
);

// From https://www.mediawiki.org/wiki/Manual:$wgConf#for_1.14_and_newer
function efGetSiteParams( $conf, $wiki ) {
	global $wikiTags;
	$site = null;
	$lang = null;
	foreach ( $conf->suffixes as $suffix ) {
		if ( substr( $wiki, -strlen( $suffix ) ) == $suffix ) {
			$site = $suffix;
			$lang = substr( $wiki, 0, -strlen( $suffix ) );
			break;
		}
	}
	return array(
		'suffix' => $site,
		'lang' => $lang,
		'params' => array(
			'lang' => $lang,
			'site' => $site,
			'wiki' => $wiki,
		),
		'tags' => isset( $wikiTags ) ? $wikiTags : array(),
	);
}

// Defaults
$wgGroupPermissions['bureaucrat']['renameuser'] = false;
$wgGroupPermissions['bureaucrat']['userrights'] = false;
$wgGroupPermissions['sysop']['importupload'] = false;
$wgGroupPermissions['user']['upload'] = false;
unset( $wgGroupPermissions['steward'] );

foreach ( $wgConf->settings['wgServer'] as $db => $server ) {
	if ( substr( $server, 0, 2 ) == '//' ) {
		$canonical =& $wgConf->settings['wgCanonicalServer'][$db];
		$canonical = $canonical ? : ( 'https:' . $server );
	}
}

$wmgDocumentURI = isset( $_SERVER['DOCUMENT_URI'] ) ? $_SERVER['DOCUMENT_URI'] : null;
$wmgHTTPhost = isset( $_SERVER['HTTP_HOST'] ) ? $_SERVER['HTTP_HOST'] : null;

if ( ( basename( $_SERVER["SCRIPT_FILENAME"] ) == "thumb.php" ) && isset( $_REQUEST['sitex'] ) ) {
	$wmgHostname = $_REQUEST['sitex'];
} elseif ( preg_match( '/^\/(.*?)\/load.php$/', $wmgDocumentURI, $matches ) ) {
	$wmgHostname = $matches[1];
} elseif ( preg_match( '/^www\.(.*?\..*?)$/', $wmgHTTPhost, $matches ) ) {
	$wmgHostname = $matches[1];
} else {
	$wmgHostname = $wmgHTTPhost;
}

$wgConf->siteParamsCallback = 'efGetSiteParams';

if ( defined( "MW_DB" ) ) {
	$wgDBname = MW_DB;
	$subdomain = substr( $wgDBname, 0, -4 );
	$server = & $wgConf->settings['wgServer'][$wgDBname];
	$wmgHostname = isset( $server ) ? $server : "$subdomain.orain.org";
// TODO: Fix this routing hack
} elseif ( $search = array_search( '//' . $wmgHostname, $wgConf->settings['wgServer'] ) ) {
	$wgDBname = $search;
} elseif ( $search = array_search( 'http://' . $wmgHostname, $wgConf->settings['wgServer'] ) ) {
	$wgDBname = $search;
} elseif ( $search = array_search( 'https://' . $wmgHostname, $wgConf->settings['wgServer'] ) ) {
	$wgDBname = $search;
} elseif ( preg_match( '/^(.+?)\.(.+?)\.orain\.org$/', $wmgHostname, $matches ) ) {
	$wgDBname = $matches[1] . $matches[2];
} elseif ( preg_match( '/^(.*)\.orain\.org$/', $wmgHostname, $matches ) ) {
	$wgDBname = $matches[1] . 'wiki';
} else {
	$wgDBname = false;
}

/**
 * Fill the database list
 */
$DBlist = array_map( 'trim', file( "$IP/all.dblist" ) );
$wgLocalDatabases = array();

foreach ( $DBlist as $wiki ) {
	$wiki = explode( '|', $wiki, 3 );
	list( $DBname, $siteName, $wikiTagList ) = array_pad( $wiki, 3, '' );
	$wgLocalDatabases[] = $DBname;
	$wgConf->settings['wgSitename'][$DBname] = $siteName;
	if ( $DBname == $wgDBname ) {
		$wikiTags = array_filter( explode( '|', $wikiTagList ) );
	}
}

$wgConf->wikis = & $wgLocalDatabases;

if ( !in_array( $wgDBname, $wgLocalDatabases ) ) {
	header( "HTTP/1.1 404 Not Found" );
	echo( <<<RESP
<html>
<head><title>404 Not Found</title></head>
<body bgcolor="white">
<center><h1>404 Not Found</h1>
<h2>Unknown database</h2></center>
<hr><center>MediaWiki</center>
</body>
</html>
RESP
	);
	exit();
}

/**
 * Do specific things for specific wikis
 */
switch( $wgDBname ) {
	case 'allthetropeswiki':
		//require_once( "$IP/extensions/CreateBox/CreateBox.php" );
		require_once( "$IP/extensions/RandomSelection/RandomSelection.php" );
		require_once( "$IP/extensions/SectionHide/SectionHide.php" );
		require_once( "$IP/extensions/CSS/CSS.php" );
		//require_once( "$IP/extensions/AJAXPoll/AJAXPoll.php" );
		require_once( "$IP/extensions/VoteNY/Vote.php" );
		require_once( "$IP/extensions/MultiBoilerplate/MultiBoilerplate.php" );
		$wgMultiBoilerplateOptions = false;
		$wgMultiBoilerplateDiplaySpecialPage = true;
		require_once( "$IP/extensions/HighlightLinksInCategory/HighlightLinksInCategory.php" );
		//require_once( "$IP/extensions/MyVariables/MyVariables.php" );
		// Configurations
		$wgSectionHideShowtop = 1;
		$wgRestrictDisplayTitle = false;
		require_once( "$IP/extensions/NewUserMessage/NewUserMessage.php" );
		require_once( "$IP/extensions/SubpageFun/SubpageFun.php" );
		require_once("$IP/extensions/SubPageList3/SubPageList3.php");
		require_once( "$IP/extensions/Tabs/Tabs.php" );
		require_once( "$IP/extensions/RegexFun/RegexFun.php" );
		require_once( "$IP/extensions/Arrays/Arrays.php" );
		require_once( "$IP/extensions/ImageMap/ImageMap.php" ); 
		break;
	case 'archivoespiralwiki':
		$wgGroupPermissions['*']['edit'] = false;
		$wgGroupPermissions['*']['createpage'] = false;
		$wgGroupPermissions['*']['createtalk'] = false;
		$wgGroupPermissions['user']['edit'] = false;
		$wgGroupPermissions['user']['createpage'] = false;
		$wgGroupPermissions['user']['createtalk'] = false;
		$wgGroupPermissions['sysop']['edit'] = true;
		$wgGroupPermissions['sysop']['createpage'] = true;
		$wgGroupPermissions['sysop']['createtalk'] = true;
		break;
	case 'botwiki':
		require_once( "$IP/extensions/LabeledSectionTransclusion/lst.php" );
		require_once( "$IP/extensions/LabeledSectionTransclusion/lsth.php" );
		break;
	case 'foodopediawiki':
		require_once( "$IP/extensions/Comments/Comment.php" );
		break;
	case 'loginwiki':
		$wgGroupPermissions['*']['createtalk'] = false;
		$wgGroupPermissions['*']['centralauth-autoaccount'] = true;
		$wgGroupPermissions['*']['read'] = true; // Make sure read rights are present
		$wgGroupPermissions['user']['read'] = true; // Make sure read rights are present
		$wgGroupPermissions['user']['edit'] = false;
		break;
	case 'metawiki':
		require_once( "$IP/extensions/CreateWiki/CreateWiki.php" );
		break;
	case 'mediawikitesterswiki':
		$wgCategoryTreeMaxChildren = 2000;
		require_once( "$IP/extensions/CreateBox/CreateBox.php" );
		require_once( "$IP/extensions/Disambiguator/Disambiguator.php" );
		require_once( "$IP/extensions/HeaderTabs/HeaderTabs.php" );
		require_once( "$IP/extensions/ImageMap/ImageMap.php" );
		require_once( "$IP/extensions/Poem/Poem.php" );
		require_once( "$IP/extensions/RandomSelection/RandomSelection.php" );
		// require_once( "$IP/extensions/SectionHide/SectionHide.php" ); // Disabled by Kudu, Requested by Arcane
		// $wgSectionHideShowtop = 1; // Disabled per the above
		require_once( "$IP/extensions/SkinPerPage/SkinPerPage.php" );
		break;
	case 'spiralwiki':
		require_once( "$IP/extensions/cldr/cldr.php" );
		break;
	case 'reviwiki':
		$wgGroupPermissions['*']['createpage'] = false;
		$wgGroupPermissions['autoconfirmed']['patrol'] = false;
		$wgGroupPermissions['user']['createpage'] = false;
		$wgGroupPermissions['user']['movefile'] = false;
		break;
	case 'extloadwiki':
		// all extensions are loaded on this wiki
		require_once( "$IP/extensions/cldr/cldr.php" );
		require_once( "$IP/extensions/CreateBox/CreateBox.php" );
		require_once( "$IP/extensions/RandomSelection/RandomSelection.php" );
		require_once( "$IP/extensions/SectionHide/SectionHide.php" );
		require_once( "$IP/extensions/LabeledSectionTransclusion/lst.php" );
		require_once( "$IP/extensions/Comments/Comment.php" );
		require_once( "$IP/extensions/CreateWiki/CreateWiki.php" );
		require_once( "$IP/extensions/Disambiguator/Disambiguator.php" );
		require_once( "$IP/extensions/HeaderTabs/HeaderTabs.php" );
		require_once( "$IP/extensions/ImageMap/ImageMap.php" );
		require_once( "$IP/extensions/Poem/Poem.php" );
		require_once( "$IP/extensions/SkinPerPage/SkinPerPage.php" );
		require_once( "$IP/extensions/CSS/CSS.php" );
		require_once( "$IP/extensions/AJAXPoll/AJAXPoll.php" );
		require_once( "$IP/extensions/VoteNY/Vote.php" );
		require_once( "$IP/extensions/MultiBoilerplate/MultiBoilerplate.php" );
		require_once( "$IP/extensions/HighlightLinksInCategory/HighlightLinksInCategory.php" );
		require_once( "$IP/extensions/MyVariables/MyVariables.php" );
		require_once( "$IP/extensions/NewUserMessage/NewUserMessage.php" );
		require_once( "$IP/extensions/SubpageFun/SubpageFun.php" );
		require_once("$IP/extensions/SubPageList3/SubPageList3.php");
		require_once( "$IP/extensions/Tabs/Tabs.php" );
		require_once( "$IP/extensions/RegexFun/RegexFun.php" );
		require_once( "$IP/extensions/Arrays/Arrays.php" );
		require_once("$IP/extensions/BlogPage/Blog.php");
		require_once( "$IP/extensions/MediaWikiChat/MediaWikiChat.php" );
		require_once("$IP/extensions/PollNY/Poll.php");
		require_once( "$IP/extensions/SocialProfile/SocialProfile.php" );
		require_once("$IP/extensions/SocialProfile/UserWelcome/UserWelcome.php");
		require_once( "$IP/extensions/WikiForum/WikiForum.php" );
		require_once("$IP/extensions/SocialProfile/UserStats/EditCount.php");
		require_once( "$IP/extensions/Maps/Maps.php" );
		require_once( "$IP/extensions/TorBlock/TorBlock.php" );
		$wgUserProfileDisplay['friends'] = true;
		$wgUserProfileDisplay['foes'] = true;
		$wgUserBoard = true;
		$wgUserProfileDisplay['board'] = true;
		$wgUserProfileDisplay['stats'] = true;
		require_once("$IP/extensions/SocialProfile/UserStats/EditCount.php"); // Necessary edit counter
		// The actual user level definitions -- key is simple: 'Level name' => points needed
		$wgUserLevels = array(
			'Troper Recruit' => 0,
			'Troper Apprentice' => 1200,
			'Troper Private' => 1750,
			'Troper Corporal' => 2500,
			'Troper Sergeant' => 5000,
			'Troper Gunnery Sergeant' => 10000,
			'Troper Lieutenant' => 20000,
			'Troper Captain' => 35000,
			'Troper Major' => 50000,
			'Troper Lieutenant Commander' => 75000,
			'Troper Commander' => 100000,
			'Troper Colonel' => 150000,
			'Troper Brigadier' => 250000,
			'Troper Brigadier General' => 350000,
			'Troper Major General' => 500000,
			'Troper Lieutenant General' => 650000,
			'Troper General' => 800000,
			'Troper General of the Army' => 1000000,
		);
		$wgUserStatsPointValues['edit'] = 50; // Points awarded on a mainspace edit
		$wgUserStatsPointValues['vote'] = 0; // Points awarded for voting for an article
		$wgUserStatsPointValues['comment'] = 0; // Points awarded for leaving a comment
		$wgUserStatsPointValues['comment_plus'] = 0; // Points awarded if your comment gets a thumbs up
		$wgUserStatsPointValues['comment_ignored'] = 0; // Points awarded if another user ignores your comments
		$wgUserStatsPointValues['opinions_created'] = 0; // Points awarded for writing a blog article
		$wgUserStatsPointValues['opinions_pub'] = 0; // Points awarded for having that article hit the "Blogs" page
		$wgUserStatsPointValues['referral_complete'] = 0; // Points awarded for recruiting a new user
		$wgUserStatsPointValues['friend'] = 0; // Points awarded for adding a friend
		$wgUserStatsPointValues['foe'] = 0; // Points awarded for adding a foe
		$wgUserStatsPointValues['gift_rec'] = 0; // Points awarded for receiving a gift
		$wgUserStatsPointValues['gift_sent'] = 0; // Points awarded for giving a gift
		$wgUserStatsPointValues['points_winner_weekly'] = 0; // Points awarded for having the most points for a week
		$wgUserStatsPointValues['points_winner_monthly'] = 0; // Points awarded for having the most points for a month
		$wgUserStatsPointValues['user_image'] = 1000; // Points awarded for adding your first avatar
		$wgUserStatsPointValues['poll_vote'] = 0; // Points awarded for taking a poll
		$wgUserStatsPointValues['quiz_points'] = 0; // Points awarded for answering a quiz question
		$wgUserStatsPointValues['quiz_created'] = 0; // Points awarded for creating a quiz question
		$wgNamespacesForEditPoints = array( 0 ); // Array of namespaces that can earn you points. Use numerical keys. Default is 0 -- only main namespace edits can earn a user points.
		break;
	case 'cpsinfowiki':
		require_once( "$IP/extensions/CreateBox/CreateBox.php" );
		break;
	case 'verkeerwiki':
		require_once( "$IP/extensions/TorBlock/TorBlock.php" );
		break;
	case 'russianmaltawiki':
		require_once( "$IP/extensions/Maps/Maps.php" );
		break;
}

/**
 * Generally setup the given wiki
 */

$wgConf->extractAllGlobals( $wgDBname );

$wgGroupPermissions['confirmed'] = & $wgGroupPermissions['autoconfirmed'];

// Group overrides
foreach ( $defaultGroupOverrides as $group => $permissions ) {
	if ( !array_key_exists( $group, $wgGroupPermissions ) ) {
		$wgGroupPermissions[$group] = array();
	}
	$wgGroupPermissions[$group] = $permissions + $wgGroupPermissions[$group];
}

foreach ( $specificGroupOverrides as $group => $permissions ) {
	if ( !array_key_exists( $group, $wgGroupPermissions ) ) {
		$wgGroupPermissions[$group] = array();
	}
	$wgGroupPermissions[$group] = $permissions + $wgGroupPermissions[$group];
}

if ( $wgDBname !== 'metawiki' ) {
	require_once( "$IP/extensions/InterwikiMagic/InterwikiMagic.php" );
	$wgForeignFileRepos[] = array(
		'class' => 'ForeignDBRepo',
		'name' => 'metawiki-foreign',
		'url' => "//$wmgUploadHostname/meta.orain.org/images",
		'hashLevels' => 2,
		'transformVia404' => true,
		'initialCapital' => true,
		'descBaseUrl' => '//meta.orain.org/wiki/File:',
		'scriptDirUrl' => '//meta.orain.org/w',
		'fetchDescription' => false,
		'dbType' => $wgDBtype,
		'dbServer' => $wgDBserver,
		'dbUser' => $wgDBuser,
		'dbPassword' => $wgDBpassword,
		'dbName' => 'metawiki',
		'dbFlags' => DBO_DEFAULT,
		'tablePrefix' => '',
		'hasSharedCache' => true,
		'directory' => "/usr/share/nginx/$wmgUploadHostname/meta.orain.org/images",
	);
}

/**
 * Define access rights for specific wiki groups
 */
if ( $wmgClosedWiki ) {
	//Assign its own CentralNotice 'project' as long as its not already orain
	if ( $wgNoticeProject !== 'orain' ) {
		$wgNoticeProject = 'closed';
	}
}

if ( $wmgPrivateWiki ) {
	// Make it easier to privatise wikis and expand on the options variably
	$wgGroupPermissions['*']['read'] = false;
	$wgGroupPermissions['user']['read'] = false;
	$wgGroupPermissions['member']['read'] = true;
	$wgGroupPermissions['sysop']['read'] = true; // Make sure Sysops/bureaucrats always have read
	$wgGroupPermissions['bureaucrat']['read'] = true;
	//Assign its own CentralNotice 'project' as long as its not already orain
	if ( $wgNoticeProject !== 'orain' ) {
		$wgNoticeProject = 'private';
	}
	// Whitelist! Default carried over for tracking.
	$wgWhitelistRead =
		array(
			"Main Page",
			"Special:UserLogin",
			"Special:UserLogout",
			"Special:ResetPassword",
			"MediaWiki:Common.css",
			"Special:CentralLogin"
		);
}

if ( $wmgDisableAnonEditing ) {
	$wgGroupPermissions['*']['edit'] = false;
	$wgGroupPermissions['*']['createpage'] = false;
}

if ( $wmgUseAPISandbox ) {
	require_once( "$IP/extensions/ApiSandbox/ApiSandbox.php" );
}

if ( $wmgUseCodeEditor ) {
	require_once( "$IP/extensions/CodeEditor/CodeEditor.php" );
	$wgScribuntoUseCodeEditor = true;
}

if ( $wmgUseCollectionPDF ) {
    require_once( "$IP/extensions/Collection/Collection.php" );
    require_once( "$IP/extensions/PdfBook/PdfBook.php" );
    // Rights
    $wgGroupPermissions['user']['collectionsavecommunitypage'] = true;
    $wgGroupPermissions['user']['collectionsaveuserpage'] = true;
}

if ( $wmgUseCharInsert ) {
	require_once( "$IP/extensions/CharInsert/CharInsert.php" );
}

if ( $wmgUseCirrus || $wmgUseCirrusAsAlternate ) {
	require_once( "$IP/extensions/CirrusSearch/CirrusSearch.php" );
	require_once( "$IP/extensions/Elastica/Elastica.php" );
	$wgCirrusSearchServers = array( '23.226.230.178');
}

if ( $wmgUseCirrus ) {
	$wgSearchType = 'CirrusSearch';
}

if ( $wmgUseDPLforum ) {
	require_once( "$IP/extensions/DPLforum/DPLforum.php" );
}

if ( $wmgUseEchoPack ) {
	require_once( "$IP/extensions/Echo/Echo.php" );
	require_once( "$IP/extensions/Thanks/Thanks.php" );
}

if ( $wmgUseIRCRC ) {
	$wgRCFeeds['Orain'] = array(
		'formatter' => 'IRCColourfulRCFeedFormatter',
		'uri' => 'udp://localhost:5070',
		'add_interwiki_prefix' => false,
		'omit_bots' => true,
	);
	$wgAbuseFilterNotifications = "udp";
}

if ( $wmgUseLiquidThreads ) {
	require_once( "$IP/extensions/LiquidThreads/LiquidThreads.php" );
}

if ( $wmgUseOrainFooter ) {
	$wgFooterIcons['poweredby']['orain'] = array(
		'src' => "//$wmgUploadHostname/meta.orain.org/images/archive/9/96/20131129195014!Powered_By_Orain.png",
		'url' => '//meta.orain.org/',
		'alt' => 'Hosted by Orain',
	);
}

if ( $wmgUseMath ) {
	require_once( "$IP/extensions/Math/Math.php" );
	$wgMathDisableTexFilter = true; // This is as we didnt Compile texvccheck - addshore
	// Use MathJax? addshore
	$wgUseMathJax = true;
	$wgDefaultUserOptions['math'] = MW_MATH_MATHJAX;
	$wgMathJaxUrl = 'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML';
	// Image stuff per Jasper Deng -- John
	$wgMathPath = $wgUploadPath;
	$wgMathDirectory = $wgUploadDirectory;
	$wgUseLaTeXML = true;
}

if ( $wmgUseMobileFrontend ) {
	require_once( "$IP/extensions/MobileFrontend/MobileFrontend.php" );
}

if ( $wmgUseQuiz ) {
	require_once( "$IP/extensions/Quiz/Quiz.php" );
}

if ( $wmgUseReplaceText ) {
	require_once( "$IP/extensions/ReplaceText/ReplaceText.php" );
}

if ( $wmgUseSideBarMenu ) {
	require_once( "$IP/extensions/Validator/ParamProcessor.php" );
	require_once( "$IP/extensions/SideBarMenu/SideBarMenu.php" );
}

if ( $wmgUseTabber ) {
	require_once( "$IP/extensions/Tabber/Tabber.php" );
}

if ( $wmgUseTranslate ) {
	// May be moved to global after testing
	require_once( "$IP/extensions/UniversalLanguageSelector/UniversalLanguageSelector.php" );

	require_once( "$IP/extensions/Translate/Translate.php" );
	$wgGroupPermissions['sysop']['pagetranslation'] = true;
	$wgGroupPermissions['sysop']['translate-import'] = true;
	$wgGroupPermissions['sysop']['translate-manage'] = true;
	$wgGroupPermissions['*']['translate'] = true;
	$wgGroupPermissions['user']['translate-messagereview'] = true;
	
	$wgGroupPermissions['translate-proofr']['translate-messagereview'] = false;
	$wgAddGroups['translate-proofr'] = false;

	// Allows the translation of the sidebar - Thanks QuimGil!
	$wgTranslateCC['wiki-sidebar'] = 'addSidebarMessageGroup';
	function addSidebarMessageGroup( $id ) {
		$mg = new WikiMessageGroup( $id, 'sidebar-messages' );
		$mg->setLabel( 'Sidebar' );
		$mg->setDescription( 'Messages used in the sidebar of this wiki' );
		return $mg;
	}
}

if ( $wmgUseWikiEditor ) {
	require_once( "$IP/extensions/WikiEditor/WikiEditor.php" );
	$wgDefaultUserOptions['usebetatoolbar'] = 1;
	$wgDefaultUserOptions['usebetatoolbar-cgd'] = 1;
}

if ( $wmgArchivedWiki ) {
	$wgReadOnly = "Archived wiki";
}

// Hack
$wgHooks['ParserFirstCallInit'][] = 'ifUserCanDebug';
function ifUserCanDebug() {
	global $wgUser, $wgShowExceptionDetails, $wgDebugToolbar, $wgDevelopmentWarnings, $wgShowSQLErrors, $wgShowDBErrorBacktrace;
	if ( $wgUser->isAllowed( 'debug' ) ) {
		error_reporting( -1 );
		ini_set( 'display_errors', 1 );
		$wgShowExceptionDetails = true;
		$wgDebugToolbar = true;
		$wgDevelopmentWarnings = true;
		$wgShowSQLErrors = true;
		$wgShowDBErrorBacktrace = true;
	}
}

if ( isset( $wgCentralAuthAutoLoginWikis[$wmgHostname] ) ) {
	// Don't log into self
	unset( $wgCentralAuthAutoLoginWikis[$wmgHostname] );
	$wgCentralAuthCookieDomain = $wmgHostname;
}

$wgCacheDirectory = '/tmp/mw-cache';
$wgFileCacheDirectory = "/var/tmp/mediawiki/cache/$wmgHostname";
$wgLoadScript = "//$wmgUploadHostname/$wmgHostname/load.php";
$wgLocalisationCacheConf['manualRecache'] = true;
$wgUploadDirectory = "/usr/share/nginx/static.orain.org/$wmgHostname/images";
$wgUploadPath = "//$wmgUploadHostname/$wmgHostname/images";

$wgDebugLogFile = "/var/log/mediawiki/$wmgHostname.log";
$wgDBerrorLog = '/var/log/mediawiki/database.log';
$wgDebugLogGroups = array(
	'404' => '/var/log/mediawiki/404.log',
	'api' => '/var/log/mediawiki/api.log',
	'captcha' => '/var/log/mediawiki/captcha.log',
	'CirrusSearch' => '/var/log/mediawiki/CirrusSearch.log',
	'collection' => '/var/log/mediawiki/collection.log',
	'exception' => '/var/log/mediawiki/exception.log',
	'Math' => '/var/log/mediawiki/Math.log',
);

// Piwik
$wgHooks['SkinAfterBottomScripts'][] = 'lfPiwikScript';
function lfPiwikScript( $skin, &$text = '' ) {
	global $wmgPiwikSiteID, $wgUser;
	if ( !$wmgPiwikSiteID ) {
		$text .= "<!-- Piwik not enabled -->\n";
		return true;
	}
	// Disabled Piwik admin blacklisting below Kudu 12/11/13
	/* if ( $wgUser->isAllowed('noanalytics') ) {
		$text .= "<!-- Piwik code omitted -->\n";
		return true;
	} */
	$id = strval( $wmgPiwikSiteID );
	$title = $skin->getRelevantTitle();
	$jstitle = Xml::encodeJsVar( $title->getPrefixedText() );
	$urltitle = $title->getPrefixedURL();
	$userType = $wgUser->isLoggedIn() ? "User" : "Anonymous";
	$text .= <<<SCRIPT
<!-- Piwik -->
<script type="text/javascript">
	var _paq = _paq || [];
	_paq.push(["trackPageView"]);
	_paq.push(["enableLinkTracking"]);

	(function() {
		var u=(("https:" == document.location.protocol) ? "https" : "http") + "://bits.orain.org/piwik/";
		_paq.push(["setTrackerUrl", u+"piwik.php"]);
		_paq.push(['setDocumentTitle', {$jstitle}]);
		_paq.push(["setSiteId", "{$id}"]);
		_paq.push(["setCustomVariable", 1, "userType", "{$userType}", "visit"]);
		var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
		g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
	})();
</script>
<!-- End Piwik Code -->
<!-- Piwik Image Tracker -->
<noscript>
<img src="//bits.orain.org/piwik/piwik.php?idsite={$id}&amp;rec=1&amp;action_name={$urltitle}" style="border:0" alt="" />
</noscript>
<!-- End Piwik -->
SCRIPT;
	return true;
}
// /Piwik
